/* Copyright (c) 2012, Code Aurora Forum. All rights reserved.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 and
 * only version 2 as published by the Free Software Foundation.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 */

#include <linux/i2c.h>

#include "msm_sensor.h"
#include "msm.h"
#include "hi256.h"

#define SENSOR_NAME "hynix256"
#define PLATFORM_DRIVER_NAME "msm_camera_hi256"
#define hi256_obj hi256_##obj
//extern int lcd_camera_power_onoff(int on);
#ifdef CDBG
#undef CDBG
#endif
#ifdef CDBG_HIGH
#undef CDBG_HIGH
#endif

#define hi256_VERBOSE_DGB

#ifdef hi256_VERBOSE_DGB
#define CDBG(fmt, args...) printk(fmt, ##args)
#define CDBG_HIGH(fmt, args...) printk(fmt, ##args)
#else
#define CDBG(fmt, args...) do { } while (0)
#define CDBG_HIGH(fmt, args...) printk(fmt, ##args)
#endif

static struct msm_sensor_ctrl_t hi256_s_ctrl;
//static int csi_config;

DEFINE_MUTEX(hi256_mut);

static struct msm_camera_i2c_reg_conf hi256_start_settings[] = {
	{0x01, 0xF1},
};

static struct msm_camera_i2c_reg_conf hi256_stop_settings[] = {
	{0x01, 0xF1},
};

static struct msm_camera_i2c_reg_conf hi256_prev_30fps_settings[] = {
	/////// PAGE 18 START ///////
//640x480
{0x03, 0x00},
{0x01, 0xf9},
{0x10, 0x00},

{0x03, 0x18},
{0x12, 0x20}, // 0x20
{0x10, 0x07}, // 0x07
{0x11, 0x00},
{0x20, 0x02},
{0x21, 0x80},
{0x22, 0x01},
{0x23, 0xe0},
{0x24, 0x00},
{0x25, 0x00},
{0x26, 0x00},
{0x27, 0x00},
{0x28, 0x02},
{0x29, 0x80},
{0x2a, 0x01},
{0x2b, 0xe0},
{0x2c, 0x14},
{0x2d, 0x00},
{0x2e, 0x14},
{0x2f, 0x00},
{0x30, 0x64},
{0x03, 0x00},

{0x03, 0x13},
{0x80, 0x00},

{0x03, 0x48},
{0x72, 0x81},
{0x30, 0x05},
{0x31, 0x00},

{0x01, 0xf8},

/////// PAGE 18 END ///////
};

static struct msm_camera_i2c_reg_conf hi256_prev_60fps_settings[] = {
/////// PAGE 18 START ///////
//640x480
{0x03, 0x00},
{0x01, 0xf9},
{0x10, 0x00},

{0x03, 0x18},
{0x12, 0x20}, // 0x20
{0x10, 0x07}, // 0x07
{0x11, 0x00},
{0x20, 0x02},
{0x21, 0x80},
{0x22, 0x01},
{0x23, 0xe0},
{0x24, 0x00},
{0x25, 0x00},
{0x26, 0x00},
{0x27, 0x00},
{0x28, 0x02},
{0x29, 0x80},
{0x2a, 0x01},
{0x2b, 0xe0},
{0x2c, 0x14},
{0x2d, 0x00},
{0x2e, 0x14},
{0x2f, 0x00},
{0x30, 0x64},
{0x03, 0x00},

{0x03, 0x13},
{0x80, 0x00},

{0x03, 0x48},
{0x72, 0x81},
{0x30, 0x05},
{0x31, 0x00},

{0x01, 0xf8},

/////// PAGE 18 END ///////	
};

static struct msm_camera_i2c_reg_conf hi256_prev_90fps_settings[] = {
/////// PAGE 18 START ///////
//640x480
{0x03, 0x00},
{0x01, 0xf9},
{0x10, 0x00},

{0x03, 0x18},
{0x12, 0x20}, // 0x20
{0x10, 0x07}, // 0x07
{0x11, 0x00},
{0x20, 0x02},
{0x21, 0x80},
{0x22, 0x01},
{0x23, 0xe0},
{0x24, 0x00},
{0x25, 0x00},
{0x26, 0x00},
{0x27, 0x00},
{0x28, 0x02},
{0x29, 0x80},
{0x2a, 0x01},
{0x2b, 0xe0},
{0x2c, 0x14},
{0x2d, 0x00},
{0x2e, 0x14},
{0x2f, 0x00},
{0x30, 0x64},
{0x03, 0x00},

{0x03, 0x13},
{0x80, 0x00},

{0x03, 0x48},
{0x72, 0x81},
{0x30, 0x05},
{0x31, 0x00},

{0x01, 0xf8},

/////// PAGE 18 END ///////	
};

static struct msm_camera_i2c_reg_conf hi256_snap_settings[] = {
	{0x03, 0x00},
	{0x01, 0xf9},//Sleep On
	{0x10, 0x00},

	{0x03, 0x13},
	{0x80, 0x7d},

	{0x03, 0x18},
	{0x12, 0x18},
	{0x10, 0x00},

	{0x03, 0x10}, //Bug 12468
	{0x10, 0x03},

	{0x03, 0x48},
	{0x30, 0x0c},
	{0x31, 0x80},

	{0x03, 0x00},
	{0x01, 0xf8},//sleep off
};


static struct msm_camera_i2c_reg_conf hi256_recommend_settings0[] = {
	/////// Start Sleep ///////
	{0x03, 0x01},
	{0x01, 0x01}, //sleep on
	{0x01, 0x03}, //soft reset
	{0x01, 0x01},
	{0x08, 0x0F}, //ADD 2012.04.23 don`t touch
	{0x0a, 0x00}, //ADD 2012.04.23 don`t touch

	/////// PAGE 20 ///////
	{0x03, 0x20}, //page 20
	{0x10, 0x0c}, //ae off

	/////// PAGE 22 ///////
	{0x03, 0x22}, //page 22
	{0x10, 0x69}, //awb off

	//Initial Start
	/////// PAGE 0 START ///////
	{0x03, 0x00},
	{0x10, 0x00}, //03}, sub1+pre2 // preview1+hbin 0x91 , preview2 0x03  0x13
	{0x11, 0x93},
	{0x12, 0x04},

	{0x0b, 0xaa},
	{0x0c, 0xaa},
	{0x0d, 0xaa},

	{0x20, 0x00},
	{0x21, 0x06},
	{0x22, 0x00},
	{0x23, 0x05},

	{0x24, 0x04},
	{0x25, 0xb0},
	{0x26, 0x06},
	{0x27, 0x40},

	{0x40, 0x01}, //Hblank 352
	{0x41, 0x68},
	{0x42, 0x00}, //Vblank 48
	{0x43, 0x48},

	{0x45, 0x04},
	{0x46, 0x18},
	{0x47, 0xd8},
	

	//BLC
	{0x80, 0x2e},
	{0x81, 0x7e},
	{0x82, 0x90},
	{0x83, 0x00},
	{0x84, 0x0c},
	{0x85, 0x00},
	{0x90, 0x06}, //0c}, //BLC_TIME_TH_ON
	{0x91, 0x06}, //0c}, //BLC_TIME_TH_OFF
	{0x92, 0xc8}, //BLC_AG_TH_ON
	{0x93, 0xc0}, //BLC_AG_TH_OFF
	{0x94, 0xff},
	{0x95, 0xff},
	{0x96, 0xdc},
	{0x97, 0xfe},
	{0x98, 0x38},

	//Dark BLC
	{0xa0, 0x00},
	{0xa2, 0x00},
	{0xa4, 0x00},
	{0xa6, 0x00},

	//Normal BLC
	{0xa8, 0x43},
	{0xaa, 0x43},
	{0xac, 0x43},
	{0xae, 0x43},

	//OutDoor  BLC
	{0x99, 0x43},
	{0x9a, 0x43},
	{0x9b, 0x43},
	{0x9c, 0x43},
	/////// PAGE 0 END ///////

	/////// PAGE 2 START ///////
	{0x03, 0x02},
	{0x12, 0x03},
	{0x13, 0x03},
	{0x15, 0x00},
	{0x16, 0x00},
	{0x17, 0x8C},
	{0x18, 0x4c}, //Double_AG//
	{0x19, 0x00},
	{0x1a, 0x39}, //Double_AG/ 38 ->39
	{0x1c, 0x09},
	{0x1d, 0x40},
	{0x1e, 0x30},
	{0x1f, 0x10},
	{0x20, 0x77},
	{0x21, 0x6d},
	{0x22, 0x77},
	{0x23, 0x30}, //CLAMP
	{0x24, 0x77}, //ADD 2012.04.23 don`t touch
	{0x27, 0x3c},
	{0x2b, 0x80},
	{0x2e, 0x00},//ADD 2012.04.23 don`t touch
	{0x2f, 0x00},//ADD 2012.04.23 don`t touch
	{0x30, 0x05}, //For Hi-253 never no change 0x05
	{0x50, 0x20},
	{0x52, 0x01}, //0x03 --> 0x01 (20100513)
	{0x53, 0xc1}, //ADD 2012.04.23 don`t touch
	{0x55, 0x1c},
	{0x56, 0x11},
	{0x58, 0x22},  //ADD 2012.04.23 don`t touch
	{0x59, 0x20},  //ADD 2012.04.23 don`t touch
	{0x5d, 0xa2},
	{0x5e, 0x5a},
	{0x60, 0x87},
	{0x61, 0x99},
	{0x62, 0x88},
	{0x63, 0x97},
	{0x64, 0x88},
	{0x65, 0x97},
	{0x67, 0x0c},
	{0x68, 0x0c},
	{0x69, 0x0c},
	{0x72, 0x89},
	{0x73, 0x96},
	{0x74, 0x89},
	{0x75, 0x96},
	{0x76, 0x89},
	{0x77, 0x96},
	{0x7c, 0x85},
	{0x7d, 0xaf},
	{0x80, 0x01},
	{0x81, 0x7f},
	{0x82, 0x13},
	{0x83, 0x24},
	{0x84, 0x7d},
	{0x85, 0x81},
	{0x86, 0x7d},
	{0x87, 0x81},
	{0x92, 0x48},
	{0x93, 0x54},
	{0x94, 0x7d},
	{0x95, 0x81},
	{0x96, 0x7d},
	{0x97, 0x81},
	{0xa0, 0x02},
	{0xa1, 0x7b},
	{0xa2, 0x02},
	{0xa3, 0x7b},
	{0xa4, 0x7b},
	{0xa5, 0x02},
	{0xa6, 0x7b},
	{0xa7, 0x02},
	{0xa8, 0x85},
	{0xa9, 0x8c},
	{0xaa, 0x85},
	{0xab, 0x8c},
	{0xac, 0x10},
	{0xad, 0x16},
	{0xae, 0x10},
	{0xaf, 0x16},
	{0xb0, 0x99},
	{0xb1, 0xa3},
	{0xb2, 0xa4},
	{0xb3, 0xae},
	{0xb4, 0x9b},
	{0xb5, 0xa2},
	{0xb6, 0xa6},
	{0xb7, 0xac},
	{0xb8, 0x9b},
	{0xb9, 0x9f},
	{0xba, 0xa6},
	{0xbb, 0xaa},
	{0xbc, 0x9b},
	{0xbd, 0x9f},
	{0xbe, 0xa6},
	{0xbf, 0xaa},
	{0xc4, 0x2c},
	{0xc5, 0x43},
	{0xc6, 0x63},
	{0xc7, 0x79},
	{0xc8, 0x2d},
	{0xc9, 0x42},
	{0xca, 0x2d},
	{0xcb, 0x42},
	{0xcc, 0x64},
	{0xcd, 0x78},
	{0xce, 0x64},
	{0xcf, 0x78},
	{0xd0, 0x0a},
	{0xd1, 0x09},
	{0xd4, 0x06}, //0c}, //DCDC_TIME_TH_ON
	{0xd5, 0x06}, //0c}, //DCDC_TIME_TH_OFF
	{0xd6, 0xc8}, //DCDC_AG_TH_ON
	{0xd7, 0xc0}, //DCDC_AG_TH_OFF
	{0xe0, 0xc4},
	{0xe1, 0xc4},
	{0xe2, 0xc4},
	{0xe3, 0xc4},
	{0xe4, 0x00},
	{0xe8, 0x80},
	{0xe9, 0x40},
	{0xea, 0x7f},
	{0xf0, 0xc1},  //ADD 2012.04.23 don`t touch
	{0xf1, 0xc1},
	{0xf2, 0xc1},
	{0xf3, 0xc1},
	{0xf4, 0xc1},

	/////// PAGE 2 END ///////

	/////// PAGE 3 ///////
	{0x03, 0x03},
	{0x10, 0x10},
	/////// PAGE 3 END ///////

	/////// PAGE 10 START ///////
	{0x03, 0x10},
	{0x10, 0x03}, // CrYCbY // For Demoset 0x03
	{0x12, 0x30},
	{0x20, 0x00},
	{0x30, 0x00},
	{0x31, 0x00},
	{0x32, 0x00},
	{0x33, 0x00},
	{0x34, 0x30},
	{0x35, 0x00},
	{0x36, 0x00},
	{0x38, 0x00},
	{0x3e, 0x58},
	{0x3f, 0x00},
	
	{0x40, 0x90},
	{0x41, 0x00},
	{0x48, 0x98},
	
	{0x60, 0x67},
	{0x61, 0x80}, //77 7a
	{0x62, 0x80}, //77  79
	{0x63, 0x50}, // Double_AG 50->30
	{0x64, 0x41},
	{0x66, 0x42},
	{0x67, 0x20},

	{0x6a, 0x80}, //8a
	{0x6b, 0x84}, //74
	{0x6c, 0x7a}, //7e
	{0x6d, 0x80}, //8e

	// {0x72, 0x84},
	// {0x76, 0x19},
	// {0x73, 0x70},
	// {0x74, 0x68},
	// {0x75, 0x60}, // white protection ON
	// {0x77, 0x0e}, //08 //0a
	// {0x78, 0x2a}, //20
	// {0x79, 0x08},

	/////// PAGE 11 START ///////
	{ 0x03, 0x11}, //11 Page
	{ 0x10, 0x7f},
	{ 0x11, 0x40},
	{ 0x12, 0x0a}, //Blue Max-Filter Delete
	{ 0x13, 0xbb},
	{ 0x26, 0x31}, //Double_AG 31->20
	{ 0x27, 0x34}, //Double_AG 34->22
	{ 0x28, 0x0f},
	{ 0x29, 0x10},
	{ 0x2b, 0x30},
	{ 0x2c, 0x32},
	{ 0x30, 0x70}, //Out2 D-LPF th
	{ 0x31, 0x10},
	{ 0x32, 0x58},
	{ 0x33, 0x09},
	{ 0x34, 0x06},
	{ 0x35, 0x03},
	{ 0x36, 0x70}, //Out1 D-LPF th
	{ 0x37, 0x18},
	{ 0x38, 0x58},
	{ 0x39, 0x09},
	{ 0x3a, 0x06},
	{ 0x3b, 0x03},
	{ 0x3c, 0x80}, //Indoor D-LPF th
	{ 0x3d, 0x18},
	{ 0x3e, 0x40},
	{ 0x3f, 0x0c},
	{ 0x40, 0x09},
	{ 0x41, 0x06},
	{ 0x42, 0x80}, //Dark1 D-LPF th
	{ 0x43, 0x18},
	{ 0x44, 0x40},
	{ 0x45, 0x13},
	{ 0x46, 0x10},
	{ 0x47, 0x10},
	{ 0x48, 0x90}, //Dark2 D-LPF th
	{ 0x49, 0x40},
	{ 0x4a, 0x58},
	{ 0x4b, 0x13},
	{ 0x4c, 0x10},
	{ 0x4d, 0x11},
	{ 0x4e, 0x80}, //Dark3 D-LPF th
	{ 0x4f, 0x30},
	{ 0x50, 0x80},
	{ 0x51, 0x13},
	{ 0x52, 0x10},
	{ 0x53, 0x13},
	{ 0x54, 0x11},
	{ 0x55, 0x0D},
	{ 0x56, 0x20},
	{ 0x57, 0x01},
	{ 0x58, 0x00},
	{ 0x59, 0x00},
	{ 0x5a, 0x1f},
	{ 0x5b, 0x3F},
	{ 0x5c, 0x00},
	{ 0x60, 0x3f},
	{ 0x62, 0x10},
	{ 0x70, 0x06},

	/////// PAGE 11 END ///////

	/////// PAGE 12 START ///////
	{ 0x03, 0x12}, //12 Page
	{ 0x20, 0x0f},
	{ 0x21, 0x0f},
	{ 0x25, 0x30},
	{ 0x28, 0x00},
	{ 0x29, 0x00},
	{ 0x2a, 0x00},
	{ 0x30, 0x30},
	{ 0x31, 0x38},
	{ 0x32, 0x42},
	{ 0x33, 0x60},
	{ 0x34, 0x70},
	{ 0x35, 0x80},
	{ 0x36, 0xa0},
	{ 0x40, 0xa0}, //Out2 th
	{ 0x41, 0x40},
	{ 0x42, 0xa0},
	{ 0x43, 0x90},
	{ 0x44, 0x90},
	{ 0x45, 0x80},
	{ 0x46, 0xb0}, //Out1 th
	{ 0x47, 0x55},
	{ 0x48, 0xa0},
	{ 0x49, 0x90},
	{ 0x4a, 0x90},
	{ 0x4b, 0x80},
	{ 0x4c, 0xb0}, //Indoor th
	{ 0x4d, 0x40},
	{ 0x4e, 0xB0},
	{ 0x4f, 0x90},
	{ 0x50, 0xC0},
	{ 0x51, 0x80},
	{ 0x52, 0xb0}, //Dark1 th
	{ 0x53, 0x60},
	{ 0x54, 0xc0},
	{ 0x55, 0xc0},
	{ 0x56, 0xc0},
	{ 0x57, 0x70},
	{ 0x58, 0x90}, //Dark2 th
	{ 0x59, 0x40},
	{ 0x5a, 0xd0},
	{ 0x5b, 0xd0},
	{ 0x5c, 0xd0},
	{ 0x5d, 0x70},
	{ 0x5e, 0x88}, //Dark3 th
	{ 0x5f, 0x40},
	{ 0x60, 0xe0},
	{ 0x61, 0xe0},
	{ 0x62, 0xe0},
	{ 0x63, 0x80},
	{ 0x70, 0x15},
	{ 0x71, 0x01}, //Don't Touch register
	{ 0x72, 0x18},
	{ 0x73, 0x01}, //Don't Touch register
	{ 0x74, 0x25},
	{ 0x75, 0x15},
	{ 0x80, 0x20},
	{ 0x81, 0x40},
	{ 0x82, 0x65},
	{ 0x85, 0x1a},
	{ 0x88, 0x00},
	{ 0x89, 0x00},
	{ 0x90, 0x5d}, //For Preview
	{ 0xD0, 0x0c}, //Don't Touch register
	{ 0xD1, 0x80},
	{ 0xD2, 0x17}, //67},
	{ 0xD3, 0x00},
	{ 0xD4, 0x00},
	{ 0xD5, 0x0f}, //02},
	{ 0xD6, 0xff},
	{ 0xD7, 0xff}, //18}, //End
	{ 0x3b, 0x06},
	{ 0x3c, 0x06},
	{ 0xc5, 0x30}, //55->48
	{ 0xc6, 0x2a}, //48->40

	{ 0x03, 0x13}, //13 Page
	{ 0x10, 0xab},
	{ 0x11, 0x7b},
	{ 0x12, 0x02}, //06},
	{ 0x14, 0x00},
	{ 0x20, 0x08}, //15},
	{ 0x21, 0x05}, //13},
	{ 0x22, 0x33},
	{ 0x23, 0x04},
	{ 0x24, 0x09},
	{ 0x25, 0x08},
	{ 0x26, 0x20},
	{ 0x27, 0x30},
	{ 0x29, 0x12},
	{ 0x2a, 0x50},
	{ 0x2b, 0x06}, //Low clip th
	{ 0x2c, 0x07},
	{ 0x25, 0x08},
	{ 0x2d, 0x0c},
	{ 0x2e, 0x12},
	{ 0x2f, 0x12},
	{ 0x50, 0x10}, //Out2 Edge
	{ 0x51, 0x14},
	{ 0x52, 0x12},
	{ 0x53, 0x0c},
	{ 0x54, 0x0f},
	{ 0x55, 0x0f},
	
	{ 0x56, 0x10}, //Out1 Edge
	{ 0x57, 0x13},
	{ 0x58, 0x12},
	{ 0x59, 0x0c},
	{ 0x5a, 0x0f},
	{ 0x5b, 0x0f},
	
	{ 0x5c, 0x1a}, //Indoor Edge
	{ 0x5d, 0x1b},
	{ 0x5e, 0x1a},
	{ 0x5f, 0x18},
	{ 0x60, 0x19},
	{ 0x61, 0x18},
	
	{ 0x62, 0x18}, //Dark1 Edge
	{ 0x63, 0x19},
	{ 0x64, 0x18},
	{ 0x65, 0x16},
	{ 0x66, 0x17},
	{ 0x67, 0x16},
	
	{ 0x68, 0x07}, //Dark2 Edge
	{ 0x69, 0x08},
	{ 0x6a, 0x07},
	{ 0x6b, 0x06},
	{ 0x6c, 0x07},
	{ 0x6d, 0x06},
	
	{ 0x6e, 0x07}, //Dark3 Edge
	{ 0x6f, 0x08},
	{ 0x70, 0x07},
	{ 0x71, 0x06},
	{ 0x72, 0x07},
	{ 0x73, 0x06},
	{ 0x80, 0xFD}, //2DY
	{ 0x81, 0x1f},
	{ 0x82, 0x01},
	{ 0x83, 0x31},
	{ 0x90, 0x3f},
	{ 0x91, 0x3f},
	{ 0x92, 0x33},
	{ 0x93, 0x30},
	{ 0x94, 0x05},
	{ 0x95, 0x0a}, //18},
	{ 0x97, 0x30},
	{ 0x99, 0x35},
	{ 0xa0, 0x01},
	{ 0xa1, 0x02},
	{ 0xa2, 0x01},
	{ 0xa3, 0x02},
	{ 0xa4, 0x02},
	{ 0xa5, 0x04},
	{ 0xa6, 0x04},
	{ 0xa7, 0x06},
	{ 0xa8, 0x05},
	{ 0xa9, 0x08},
	{ 0xaa, 0x05},
	{ 0xab, 0x08},
	{ 0xb0, 0x22}, //Out2
	{ 0xb1, 0x2a},
	{ 0xb2, 0x28},
	{ 0xb3, 0x22},
	{ 0xb4, 0x2a},
	{ 0xb5, 0x28},
	{ 0xb6, 0x22}, //Out1
	{ 0xb7, 0x2a},
	{ 0xb8, 0x28},
	{ 0xb9, 0x22},
	{ 0xba, 0x2a},
	{ 0xbb, 0x28},
	{ 0xbc, 0x1e}, //27}, //Indoor
	{ 0xbd, 0x24}, //30},
	{ 0xbe, 0x20}, //2a},
	{ 0xbf, 0x1e}, //27},
	{ 0xc0, 0x24}, //30},
	{ 0xc1, 0x20}, //2a},
	{ 0xc2, 0x1e}, //Dark1
	{ 0xc3, 0x24},
	{ 0xc4, 0x20},
	{ 0xc5, 0x1e},
	{ 0xc6, 0x24},
	{ 0xc7, 0x20},
	{ 0xc8, 0x18}, //Dark2
	{ 0xc9, 0x20},
	{ 0xca, 0x1e},
	{ 0xcb, 0x18},
	{ 0xcc, 0x20},
	{ 0xcd, 0x1e},
	{ 0xce, 0x18}, //Dark3
	{ 0xcf, 0x20},
	{ 0xd0, 0x1e},
	{ 0xd1, 0x18},
	{ 0xd2, 0x20},
	{ 0xd3, 0x1e},

	/////// PAGE 13 END ///////

	/////// PAGE 14 START ///////
	{0x03, 0x14},
	{0x10, 0x11},

	{0x14, 0x80}, // GX
	{0x15, 0x80}, // GY
	{0x16, 0x80}, // RX
	{0x17, 0x80}, // RY
	{0x18, 0x80}, // BX
	{0x19, 0x80}, // BY

	{0x20, 0x80}, //X
	{0x21, 0x80}, //Y

	{0x22, 0x80},
	{0x23, 0x80},
	{0x24, 0x80},

	{0x30, 0xc8},
	{0x31, 0x2b},
	{0x32, 0x00},
	{0x33, 0x00},
	{0x34, 0x90},

	{0x40, 0x32}, //35
	{0x50, 0x21}, //22
	{0x60, 0x19}, //1a
	{0x70, 0x21}, //22
	/////// PAGE 14 END ///////

	/////// PAGE 15 START ///////
	{0x03, 0x15},
	{0x10, 0x0f},

	//Rstep H 16
	//Rstep L 14
	{0x14, 0x46}, //CMCOFSGH
	{0x15, 0x36}, //CMCOFSGM
	{0x16, 0x26}, //CMCOFSGL
	{0x17, 0x2f}, //CMC SIGN

	//CMC
	{0x30, 0x8f},
	{0x31, 0x59},
	{0x32, 0x0a},
	{0x33, 0x15},
	{0x34, 0x5b},
	{0x35, 0x06},
	{0x36, 0x07},
	{0x37, 0x40},
	{0x38, 0x87}, //86

	//CMC OFS
	{0x40, 0x94},
	{0x41, 0x20},
	{0x42, 0x89},
	{0x43, 0x84},
	{0x44, 0x03},
	{0x45, 0x01},
	{0x46, 0x88},
	{0x47, 0x9c},
	{0x48, 0x28},

	//CMC POFS
	{0x50, 0x02},
	{0x51, 0x82},
	{0x52, 0x00},
	{0x53, 0x07},
	{0x54, 0x11},
	{0x55, 0x98},
	{0x56, 0x00},
	{0x57, 0x0b},
	{0x58, 0x8b},

	{0x80, 0x03},
	{0x85, 0x40},
	{0x87, 0x02},
	{0x88, 0x00},
	{0x89, 0x00},
	{0x8a, 0x00},
	/////// PAGE 15 END ///////

	/////// PAGE 16 START ///////
	{0x03, 0x16},
	{0x10, 0x31},
	{0x18, 0x5e},// Double_AG 5e->37
	{0x19, 0x5d},// Double_AG 5e->36
	{0x1a, 0x0e},
	{0x1b, 0x01},
	{0x1c, 0xdc},
	{0x1d, 0xfe},

	//GMA Default
	{0x30, 0x00},
	{0x31, 0x0a},
	{0x32, 0x1f},
	{0x33, 0x33},
	{0x34, 0x53},
	{0x35, 0x6c},
	{0x36, 0x81},
	{0x37, 0x94},
	{0x38, 0xa4},
	{0x39, 0xb3},
	{0x3a, 0xc0},
	{0x3b, 0xcb},
	{0x3c, 0xd5},
	{0x3d, 0xde},
	{0x3e, 0xe6},
	{0x3f, 0xee},
	{0x40, 0xf5},
	{0x41, 0xfc},
	{0x42, 0xff},

	{0x50, 0x00},
	{0x51, 0x08},
	{0x52, 0x1e},
	{0x53, 0x36},
	{0x54, 0x5a},
	{0x55, 0x75},
	{0x56, 0x8d},
	{0x57, 0xa1},
	{0x58, 0xb2},
	{0x59, 0xbe},
	{0x5a, 0xc9},
	{0x5b, 0xd2},
	{0x5c, 0xdb},
	{0x5d, 0xe3},
	{0x5e, 0xeb},
	{0x5f, 0xf0},
	{0x60, 0xf5},
	{0x61, 0xf7},
	{0x62, 0xf8},

	{0x70, 0x00},
	{0x71, 0x08},
	{0x72, 0x17},
	{0x73, 0x2f},
	{0x74, 0x53},
	{0x75, 0x6c},
	{0x76, 0x81},
	{0x77, 0x94},
	{0x78, 0xa4},
	{0x79, 0xb3},
	{0x7a, 0xc0},
	{0x7b, 0xcb},
	{0x7c, 0xd5},
	{0x7d, 0xde},
	{0x7e, 0xe6},
	{0x7f, 0xee},
	{0x80, 0xf4},
	{0x81, 0xfa},
	{0x82, 0xff},
	/////// PAGE 16 END ///////

	/////// PAGE 17 START ///////
	{0x03, 0x17},
	{0x10, 0xf7},
	{0xC4, 0x66}, //FLK200
	{0xC5, 0x55}, //FLK240
	/////// PAGE 17 END ///////

	/////// PAGE 18 START ///////
	//640x480
	{0x03, 0x18},
	{0x12, 0x18}, // 0x20
	{0x10, 0x00}, // 0x07
	{0x11, 0x00},
	{0x20, 0x02},
	{0x21, 0x80},
	{0x22, 0x01},
	{0x23, 0xe0},
	{0x24, 0x00},
	{0x25, 0x00},
	{0x26, 0x00},
	{0x27, 0x00},
	{0x28, 0x02},
	{0x29, 0x80},
	{0x2a, 0x01},
	{0x2b, 0xe0},
	{0x2c, 0x0a},
	{0x2d, 0x00},
	{0x2e, 0x0a},
	{0x2f, 0x00},
	{0x30, 0x25},
	
	/////// PAGE 18 END ///////


	/////// PAGE 20 START ///////
	{0x03, 0x20},
	{0x11, 0x1c},
	{0x18, 0x30},
	{0x1a, 0x08},
	{0x20, 0x05},
	{0x21, 0x30},
	{0x22, 0x10},
	{0x23, 0x00},
	{0x24, 0x00},

	{0x28, 0xe7},
	{0x29, 0x0d}, //20100305 ad->0d
	{0x2a, 0xf0},
	{0x2b, 0x34},
	{0x30, 0x78},

	{0x2c, 0xc2},
	{0x2d, 0xff},
	{0x2e, 0x33},
	{0x30, 0xf8},
	{0x32, 0x03},
	{0x33, 0x2e},
	{0x34, 0x30},
	{0x35, 0xd4},
	{0x36, 0xfe},
	{0x37, 0x32},
	{0x38, 0x04},
	{0x3a, 0xde},
	{0x3b, 0x22},
	{0x3c, 0xde},

	{0x50, 0x45},
	{0x51, 0x88},

	{0x56, 0x03},
	{0x57, 0xf7},
	{0x58, 0x14},
	{0x59, 0x88},
	{0x5a, 0x04},

	//{0x60, 0xaa},
	//{0x61, 0xaa},
	//{0x62, 0xaa},
	//{0x63, 0xaa},
	//{0x64, 0xaa},
	//{0x65, 0xaa},
	//{0x66, 0xab},
	//{0x67, 0xEa},
	//{0x68, 0xab},
	//{0x69, 0xEa},
	//{0x6a, 0xaa},
	//{0x6b, 0xaa},
	//{0x6c, 0xaa},
	//{0x6d, 0xaa},
	//{0x6e, 0xaa},
	//{0x6f, 0xaa},

	{0x60, 0x55},
	{0x61, 0x55},
	{0x62, 0x6a},
	{0x63, 0xa9},
	{0x64, 0x6a},
	{0x65, 0xa9},
	{0x66, 0x6b},
	{0x67, 0xE9},
	{0x68, 0x6b},
	{0x69, 0xE9},
	{0x6a, 0x6a},
	{0x6b, 0xa9},
	{0x6c, 0x6a},
	{0x6d, 0xa9},
	{0x6e, 0x55},
	{0x6f, 0x55},


	{0x70, 0x76}, //6c
	{0x71, 0x82}, //82(+8)

	{0x76, 0x43},
	{0x77, 0x04},
	{0x78, 0x23}, //24
	{0x79, 0x46}, // Y Target 70 => 25, 72 => 26 //
	{0x7a, 0x23}, //23
	{0x7b, 0x22}, //22
	{0x7d, 0x23},

	{0x83, 0x01}, //EXP Normal 33.33 fps
	{0x84, 0x5f},
	{0x85, 0x90},
	{0x86, 0x01}, //EXPMin 10204.08 fps
	{0x87, 0xf4},
	
	{0x88, 0x05}, //EXP Max 10.00 fps
	{0x89, 0x09},
	{0x8a, 0x10},
	
	{0x8B, 0x75}, //EXP100
	{0x8C, 0x30},
	{0x8D, 0x61}, //EXP120
	{0x8E, 0xa8},

	{0x98, 0x9d},
	{0x99, 0x45},
	{0x9a, 0x0d},
	{0x9b, 0xde},

	{0x9c, 0x17}, //EXP Limit 850.34 fps
	{0x9d, 0x70},
	{0x9e, 0x01}, //EXP Unit
	{0x9f, 0xf4},

	{0xb0, 0x18},
	{0xb1, 0x14},
	{0xb2, 0xa0},
	{0xb3, 0x18},
	{0xb4, 0x1a},
	{0xb5, 0x44},
	{0xb6, 0x2f},
	{0xb7, 0x28},
	{0xb8, 0x25},
	{0xb9, 0x22},
	{0xba, 0x21},
	{0xbb, 0x20},
	{0xbc, 0x32},
	{0xbd, 0x30},

	{0xc0, 0x10},
	{0xc1, 0x2b},
	{0xc2, 0x2b},
	{0xc3, 0x2b},
	{0xc4, 0x08},

	{0xc8, 0x40},
	{0xc9, 0x40},
	/////// PAGE 20 END ///////

	/////// PAGE 22 START ///////
	{0x03, 0x22},
	{0x10, 0xfd},
	{0x11, 0x2e},
	{0x19, 0x01}, // Low On //
	{0x20, 0x10},
	{0x21, 0x80},
	{0x24, 0x01},
	// {0x25, 0x00}, //7f New Lock Cond & New light stable

	{0x30, 0x80},
	{0x31, 0x80},
	{0x38, 0x11},
	{0x39, 0x34},
	{0x40, 0xfa},

	{0x41, 0x44}, //33
	{0x42, 0x43}, //22
	{0x43, 0xf6},
	{0x44, 0x44},
	{0x45, 0x33},
	{0x46, 0x00},
	{0x50, 0xb2},
	{0x51, 0x81},
	{0x52, 0x98},

	{0x80, 0x38},
	{0x81, 0x20},
	{0x82, 0x38}, //3a

	{0x83, 0x5e}, //5e
	{0x84, 0x20}, //24
	{0x85, 0x4f}, //54
	{0x86, 0x20}, //24 //22

	{0x87, 0x49},
	{0x88, 0x39},
	{0x89, 0x37}, //38
	{0x8a, 0x29}, //2a

	{0x8b, 0x41}, //47
	{0x8c, 0x39},
	{0x8d, 0x34},
	{0x8e, 0x29}, //2c

	{0x8f, 0x55},
	{0x90, 0x55},
	{0x91, 0x50},
	{0x92, 0x49},
	{0x93, 0x3e},
	{0x94, 0x3a},
	{0x95, 0x30}, //39
	{0x96, 0x28}, //2f
	{0x97, 0x23},
	{0x98, 0x20},
	{0x99, 0x1f},
	{0x9a, 0x1f},

	{0x9b, 0x77},
	{0x9c, 0x66},
	{0x9d, 0x48},
	{0x9e, 0x38},
	{0x9f, 0x30},

	{0xa0, 0x60},
	{0xa1, 0x34},
	{0xa2, 0x6f},
	{0xa3, 0xff},

	{0xa4, 0x14}, //1500fps
	{0xa5, 0x2c}, // 700fps
	{0xa6, 0xcf},

	{0xad, 0x40},
	{0xae, 0x4a},

	{0xaf, 0x28}, //low temp Rgain
	{0xb0, 0x26}, //low temp Rgain

	{0xb1, 0x00}, //0x20 -> 0x00 0405 modify
	{0xb4, 0xea},
	{0xb8, 0xa0}, //a2: b-2, R+2  //b4 B-3, R+4 lowtemp
	{0xb9, 0x00},
	/////// PAGE 22 END ///////

	/////// PAGE 48 (MiPi 1600x1200) ///////
	{0x03, 0x48},

	// PLL Setting //
	{0x70, 0x05}, //04},
	{0x71, 0x30}, //27},  //Pllx1
	{0x72, 0x81}, //81},  // Full size & preview2 0x81, HBIN+preview1 0x85
	{0x73, 0x10},
	{0x70, 0x85}, //84},  // PLL Enable
	{0x03, 0x48},
	{0x03, 0x48},
	{0x03, 0x48},
	{0x03, 0x48},
	{0x70, 0x95}, //94},  // CLK_GEN_ENABLE

	// MIPI TX Setting //
	{0x10, 0x1c},
	{0x11, 0x00}, //rev120807 // non continuous mode
	{0x12, 0x00},
	{0x14, 0x00}, // {0x14, 0x70},
	{0x16, 0x04},
	{0x18, 0x80},
	{0x19, 0x00},
	{0x1a, 0xa0},
	{0x1b, 0x0d},
	{0x1c, 0x01},
	{0x1d, 0x0a},
	{0x1e, 0x07},
	{0x1f, 0x0b},
	// {0x20, 0x00},

	{0x23, 0x01},
	{0x24, 0x1e},
	{0x25, 0x00},
	{0x26, 0x00},
	{0x27, 0x08},
	{0x28, 0x00},
	// {0x2a, 0x06},
	// {0x2b, 0x40},
	// {0x2c, 0x04},
	// {0x2d, 0xb0},

	{0x30, 0x0c}, // 0x05//0x0c
	{0x31, 0x80}, // 0x00//0x80

	{0x32, 0x13},
	{0x33, 0x0c},
	{0x34, 0x04}, //03}, //rev120807 04},
	{0x35, 0x06}, //04}, //rev120807 06},
	{0x36, 0x01}, //02}, //rev120807 01},
	{0x37, 0x06},
	{0x39, 0x4f},

	{0x1c, 0x08},
	{0x1d, 0x0c},
	{0x1f, 0x0a},

	/////// PAGE 20 ///////
	{0x03, 0x20},
	{0x10, 0x9c}, //50hz, 0x8c == 60hz

	/////// PAGE 22 ///////
	{0x03, 0x22},
	{0x10, 0xe9},

	/////// PAGE 0 ///////
	{0x03, 0x00},
	{0x03, 0x00},
	{0x03, 0x00},
	{0x03, 0x00},
	{0x03, 0x00},
	{0x03, 0x00},
	{0x03, 0x00},
	{0x03, 0x00},
	{0x03, 0x00},
	{0x03, 0x00},
	{0x03, 0x00},
	{0x01, 0x00},
};


static struct msm_camera_i2c_conf_array hi256_init_conf[] = {
	{&hi256_recommend_settings0[0],
	ARRAY_SIZE(hi256_recommend_settings0), 50, MSM_CAMERA_I2C_BYTE_DATA},
};


static struct msm_camera_i2c_conf_array hi256_confs[] = {
	{&hi256_snap_settings[0],
	ARRAY_SIZE(hi256_snap_settings), 100, MSM_CAMERA_I2C_BYTE_DATA},
	{&hi256_prev_30fps_settings[0],
	ARRAY_SIZE(hi256_prev_30fps_settings), 50, MSM_CAMERA_I2C_BYTE_DATA},
	{&hi256_prev_60fps_settings[0],
	ARRAY_SIZE(hi256_prev_60fps_settings),50 , MSM_CAMERA_I2C_BYTE_DATA},
	{&hi256_prev_90fps_settings[0],
	ARRAY_SIZE(hi256_prev_90fps_settings),50 , MSM_CAMERA_I2C_BYTE_DATA},
};



static struct msm_camera_csi_params hi256_csi_params = {
	.data_format = CSI_8BIT,
	.lane_cnt = 1,
	.lane_assign = 0xe4,
	.dpcm_scheme = 0,
	.settle_cnt  = 0x21,
};


static struct v4l2_subdev_info hi256_subdev_info[] = {
	{
		.code   = V4L2_MBUS_FMT_YUYV8_2X8,
		.colorspace = V4L2_COLORSPACE_JPEG,
		.fmt    = 1,
		.order    = 0,
	},
	/* more can be supported, to be added later */
};



static struct msm_sensor_output_info_t hi256_dimensions[] = {
	{ /* For SNAPSHOT 15fps*/
		.x_output = 0x640,  /*1600*/  /*for 2Mp*/
		.y_output = 0x4B0,  /*1200*/
		.line_length_pclk = 0x800,
		.frame_length_lines = 0x4E2,
		.vt_pixel_clk = 48000000,
		.op_pixel_clk = 48000000,
		.binning_factor = 0x0,
	},
	{ /* For PREVIEW 30fps*/
		.x_output = 0x0280,  /*640*/  /*for 2Mp*/
		.y_output = 0x01E0,  /*480*/
		.line_length_pclk = 0x440,
		.frame_length_lines = 0x212,
		.vt_pixel_clk = 48000000,
		.op_pixel_clk = 48000000,
		.binning_factor = 0x0,
	},
	{ /* For PREVIEW 60 fps*/
		.x_output = 0x0280,  /*640*/  /*for 2Mp*/
		.y_output = 0x01E0,  /*480*/
		.line_length_pclk = 0x440,
		.frame_length_lines = 0x212,
		.vt_pixel_clk = 48000000,
		.op_pixel_clk = 48000000,
		.binning_factor = 0x0,
	},
	{ /* For PREVIEW 90 fps*/
		.x_output = 0x0280,  /*640*/  /*for 2Mp*/
		.y_output = 0x01E0,  /*480*/
		.line_length_pclk = 0x440,
		.frame_length_lines = 0x212,
		.vt_pixel_clk = 48000000,
		.op_pixel_clk = 48000000,
		.binning_factor = 0x0,
	},
};

static struct msm_sensor_output_reg_addr_t hi256_reg_addr = {
};

static struct msm_camera_csi_params *hi256_csi_params_array[] = {
	&hi256_csi_params,
	&hi256_csi_params,
	&hi256_csi_params, //60fps
	&hi256_csi_params, //90fps
};


static struct msm_sensor_id_info_t hi256_id_info = {
	.sensor_id_reg_addr = 0x04,
	.sensor_id = 0xc0,
};

static const struct i2c_device_id hi256_i2c_id[] = {
	{SENSOR_NAME, (kernel_ulong_t)&hi256_s_ctrl},
	{}
};

int32_t hi256_sensor_i2c_probe(struct i2c_client *client,
	const struct i2c_device_id *id)
{
	int32_t rc = 0;
	struct msm_sensor_ctrl_t *s_ctrl;

	CDBG("%s IN\r\n", __func__);
	s_ctrl = (struct msm_sensor_ctrl_t *)(id->driver_data);
	s_ctrl->sensor_i2c_addr = s_ctrl->sensor_i2c_addr;

	rc = msm_sensor_i2c_probe(client, id);

	if (client->dev.platform_data == NULL) {
		CDBG_HIGH("%s: NULL sensor data\n", __func__);
		return -EFAULT;
	}

	usleep_range(5000, 5100);

	return rc;
}

static struct i2c_driver hi256_i2c_driver = {
	.id_table = hi256_i2c_id,
	.probe  = hi256_sensor_i2c_probe,
	.driver = {
		.name = SENSOR_NAME,
	},
};



static struct msm_camera_i2c_client hi256_sensor_i2c_client = {
//	.addr_type = MSM_CAMERA_I2C_WORD_ADDR,
	.addr_type = MSM_CAMERA_I2C_BYTE_ADDR,
};

static int __init msm_sensor_init_module(void)
{
	return i2c_add_driver(&hi256_i2c_driver);
}


static struct v4l2_subdev_core_ops hi256_subdev_core_ops = {
	//.s_ctrl = msm_sensor_v4l2_s_ctrl,
	//.queryctrl = msm_sensor_v4l2_query_ctrl,
	.ioctl = msm_sensor_subdev_ioctl,
	.s_power = msm_sensor_power,
};

static struct v4l2_subdev_video_ops hi256_subdev_video_ops = {
	.enum_mbus_fmt = msm_sensor_v4l2_enum_fmt,
};

static struct v4l2_subdev_ops hi256_subdev_ops = {
	.core = &hi256_subdev_core_ops,
	.video  = &hi256_subdev_video_ops,
};


//static void hi256_power_reset(struct  msm_camera_sensor_info *sensordata);


int32_t hi256_sensor_power_up(struct msm_sensor_ctrl_t *s_ctrl)
{
	int32_t rc = 0;
	struct msm_camera_sensor_info *info = NULL;

	CDBG("%s: %d\n", __func__, __LINE__);

	info = s_ctrl->sensordata;

	CDBG("%s, sensor_pwd:%d, sensor_reset:%d\r\n",__func__, info->sensor_pwd, info->sensor_reset);
	 rc = gpio_request(info->sensor_pwd,"hynix256");
        if(0 == rc){
                rc = gpio_tlmm_config(GPIO_CFG(info->sensor_pwd, 0,GPIO_CFG_OUTPUT,
                            GPIO_CFG_PULL_UP, GPIO_CFG_2MA), GPIO_CFG_ENABLE);
                if(rc < 0){
                        gpio_free(info->sensor_pwd);
                        CDBG("s5k5ca gpio_tlmm_config(%d) fail",info->sensor_reset);
                        return rc;
                }
        }

 	rc = gpio_request(info->sensor_reset,"hynix256");
        if(0 == rc){
                rc = gpio_tlmm_config(GPIO_CFG(info->sensor_reset, 0,GPIO_CFG_OUTPUT,
                            GPIO_CFG_PULL_UP, GPIO_CFG_2MA), GPIO_CFG_ENABLE);
                if(rc < 0){
                        gpio_free(info->sensor_reset);
                        CDBG("s5k5ca gpio_tlmm_config(%d) fail",info->sensor_reset);
                        return rc;
                }
        }
	gpio_direction_output(info->sensor_pwd, 1);
	if (info->sensor_reset_enable){
		gpio_direction_output(info->sensor_reset, 0);
	}
	usleep_range(10000, 11000);
	if (info->pmic_gpio_enable) {
	//	lcd_camera_power_onoff(1);
	}
	usleep_range(10000, 11000);

	rc = msm_sensor_power_up(s_ctrl);
	if (rc < 0) {
		CDBG("%s: msm_sensor_power_up failed\n", __func__);
		return rc;
	}

	/* turn on ldo and vreg */
	usleep_range(1000, 1100);
	gpio_direction_output(info->sensor_pwd, 0);
	msleep(20);
	if (info->sensor_reset_enable){
		gpio_direction_output(info->sensor_reset, 1);
	}
	msleep(25);
/*
	printk(KERN_ALERT"84 up\n");
	gpio_direction_output(84, 1);
	printk(KERN_ALERT"113 up\n");
	gpio_direction_output(113, 0);
*/
	return rc;
}

int32_t hi256_sensor_power_down(struct msm_sensor_ctrl_t *s_ctrl)
{
	int32_t rc = 0;

	struct msm_camera_sensor_info *info = NULL;

	CDBG("%s IN\r\n", __func__);
	info = s_ctrl->sensordata;

	msm_sensor_stop_stream(s_ctrl);
	msleep(20);

	gpio_direction_output(info->sensor_pwd, 1);
	usleep_range(5000, 5100);

	rc = msm_sensor_power_down(s_ctrl);
	msleep(40);
	if (s_ctrl->sensordata->pmic_gpio_enable){
//		lcd_camera_power_onoff(0);
	}

	gpio_free(info->sensor_pwd);
	gpio_free(info->sensor_reset);

	return rc;
}

#if 0
/* ***********************match_id start************************** */
static int hi256_i2c_txdata(struct msm_camera_i2c_client * client,
				u16 saddr,
				u8 *txdata,
				int length)
{
	unsigned short loacal_saddr = saddr >> 1;
	struct i2c_msg msg[] = {
		{
			.addr  = loacal_saddr,
			.flags = 0,
			.len = length,
			.buf = txdata,
		},
	};

	if (i2c_transfer(client->client->adapter, msg, 1) < 0)
		return -EIO;
	else
		return 0;
}

static int hi256_i2c_rxdata(struct msm_camera_i2c_client * client,
				unsigned short saddr,
				unsigned char *rxdata,
				int length)
{
	unsigned short loacal_saddr = saddr >> 1;
	struct i2c_msg msgs[] = {
		{
			.addr   = loacal_saddr,
			.flags = 0,
			.len   = 2,
			.buf   = rxdata,
		},
		{
			.addr   = loacal_saddr,
			.flags = I2C_M_RD,
			.len   = length,
			.buf   = rxdata,
		},
	};

	if (i2c_transfer(client->client->adapter, msgs, 2) < 0) {
		CDBG("hi256_i2c_rxdata failed!\n");
		return -EIO;
	}

	return 0;
}

static int32_t hi256_i2c_read_word(struct msm_camera_i2c_client * client,
				unsigned short saddr,
				unsigned int raddr,
				unsigned int *rdata)
{
	int32_t rc = 0;
	unsigned char buf[4] = {0};

	if (!rdata)
	return -EIO;

	buf[0] = (raddr & 0xFF00)>>8;
	buf[1] = (raddr & 0x00FF);

	rc = hi256_i2c_rxdata(client, saddr, buf, 2);
	if (rc < 0) {
		CDBG("hi256_i2c_read_word failed!\n");
		return rc;
	}
	*rdata = buf[0] << 8 | buf[1];

	return rc;
}

static int hi256_i2c_write_word(struct msm_camera_i2c_client * client,
				unsigned short saddr,
				unsigned int waddr,
				unsigned int wdata)
{
	int rc = -EIO;
	int counter = 0;
	unsigned char buf[4] = {0};
	buf[0] = (waddr & 0xFF00)>>8;
	buf[1] = (waddr & 0x00FF);
	buf[2] = (wdata & 0xFF00)>>8;
	buf[3] = (wdata & 0x00FF);

	while ((counter < 10) &&(rc != 0))
	{
		rc = hi256_i2c_txdata(client, saddr, buf, 4);
		CDBG("hi256_i2c_write_word, Reg(0x%04x) = 0x%04x, rc=%d!\n",waddr, wdata,rc);
		if (rc < 0)
		{
			counter++;
			CDBG("hi256_i2c_txdata failed,Reg(0x%04x) = 0x%04x, rc=%d!\n", waddr, wdata,rc);
		}
	}

	return rc;
}
#endif

int32_t hi256_sensor_match_id(struct msm_sensor_ctrl_t *s_ctrl)
{
    uint16_t id = 0;
    int32_t rc = -1;
    printk("hi542 sensor read id\n");
	rc = msm_camera_i2c_write(s_ctrl->sensor_i2c_client,
			0x03,
			0x0, MSM_CAMERA_I2C_BYTE_DATA);
	rc = msm_camera_i2c_read(s_ctrl->sensor_i2c_client,
			s_ctrl->sensor_id_info->sensor_id_reg_addr,
			&id, MSM_CAMERA_I2C_BYTE_DATA);
    printk("hi256 readid 0x%x : 0x%x\n", 0xC0, id);
	if (rc < 0) {
		printk("%s: read id failed\n", __func__);
		return rc;
	}
    if (id != s_ctrl->sensor_id_info->sensor_id) {
		return -ENODEV;
    }
    printk("hi256 readid ok, success\n");
	return rc;
}

/*
static void hi256_power_reset(struct  msm_camera_sensor_info *sensordata);
static void hi256_power_reset(struct  msm_camera_sensor_info *sensordata)
{
	CDBG("%s\n",__func__);
	gpio_set_value(sensordata->sensor_reset, 1);
	msleep(1);
	gpio_set_value(sensordata->sensor_reset, 0);
	msleep(1);
	gpio_set_value(sensordata->sensor_reset, 1);
	msleep(1);
}
*/
int32_t hi256_sensor_setting(struct msm_sensor_ctrl_t *s_ctrl,
	int update_type, int res)
{
	int32_t rc = 0;
	static int csi_config;

	if (update_type == MSM_SENSOR_REG_INIT) {
		CDBG("Register INIT\n");
		s_ctrl->curr_csi_params = NULL;
		msm_sensor_enable_debugfs(s_ctrl);
		msm_sensor_write_init_settings(s_ctrl);
		csi_config = 0;
	} else if (update_type == MSM_SENSOR_UPDATE_PERIODIC) {
		CDBG("PERIODIC : %d\n", res);
		if (!csi_config) {
			s_ctrl->curr_csic_params = s_ctrl->csic_params[res];
			CDBG("CSI config in progress\n");
			v4l2_subdev_notify(&s_ctrl->sensor_v4l2_subdev,
				NOTIFY_CSIC_CFG,
				s_ctrl->curr_csic_params);
			CDBG("CSI config is done\n");
			mb();
			msleep(50);
			csi_config = 1;
		}

		msm_sensor_write_conf_array(
			s_ctrl->sensor_i2c_client,
			s_ctrl->msm_sensor_reg->mode_settings, res);

		v4l2_subdev_notify(&s_ctrl->sensor_v4l2_subdev,
			NOTIFY_PCLK_CHANGE,
			&s_ctrl->sensordata->pdata->ioclk.vfe_clk_rate);
	}
	return rc;
}


static struct msm_sensor_fn_t hi256_func_tbl = {
	.sensor_start_stream = msm_sensor_start_stream,
	.sensor_stop_stream = msm_sensor_stop_stream,
	.sensor_group_hold_on = msm_sensor_group_hold_on,
	.sensor_group_hold_off = msm_sensor_group_hold_off,

	.sensor_csi_setting = hi256_sensor_setting,
	.sensor_set_sensor_mode = msm_sensor_set_sensor_mode,
	.sensor_mode_init = msm_sensor_mode_init,
	.sensor_get_output_info = msm_sensor_get_output_info,
	.sensor_config = msm_sensor_config,
	.sensor_power_up = hi256_sensor_power_up,
	.sensor_power_down = hi256_sensor_power_down,
	.sensor_match_id = hi256_sensor_match_id,
};

#if 1
static struct msm_sensor_reg_t hi256_regs = {
	.default_data_type = MSM_CAMERA_I2C_BYTE_DATA,
	.start_stream_conf = hi256_start_settings,
	.start_stream_conf_size = ARRAY_SIZE(hi256_start_settings),
	.stop_stream_conf = hi256_stop_settings,
	.stop_stream_conf_size = ARRAY_SIZE(hi256_stop_settings),
	.group_hold_on_conf = NULL,
	.group_hold_on_conf_size = 0,
	.group_hold_off_conf = NULL,
	.group_hold_off_conf_size = 0,
	.init_settings = &hi256_init_conf[0],
	.init_size = ARRAY_SIZE(hi256_init_conf),
	.mode_settings = &hi256_confs[0],
	.output_settings = &hi256_dimensions[0],
	.num_conf = ARRAY_SIZE(hi256_confs),
};
#else
static struct msm_sensor_reg_t hi256_regs = {
	.default_data_type = MSM_CAMERA_I2C_BYTE_DATA,
	.start_stream_conf = hi256_start_settings,
	.start_stream_conf_size = ARRAY_SIZE(hi256_start_settings),
	.stop_stream_conf = hi256_stop_settings,
	.stop_stream_conf_size = ARRAY_SIZE(hi256_stop_settings),
	.init_settings = &hi256_init_conf[0],
	.init_size = ARRAY_SIZE(hi256_init_conf),
	.mode_settings = &hi256_confs[0],
	.no_effect_settings = &hi256_no_effect_confs[0],
	.output_settings = &hi256_dimensions[0],
	.num_conf = ARRAY_SIZE(hi256_confs),
};

#endif

#if 0
static struct msm_sensor_ctrl_t hi256_s_ctrl = {
	.msm_sensor_reg = &hi256_regs,
	.msm_sensor_v4l2_ctrl_info = hi256_v4l2_ctrl_info,
	.num_v4l2_ctrl = ARRAY_SIZE(hi256_v4l2_ctrl_info),
	.sensor_i2c_client = &hi256_sensor_i2c_client,
	.sensor_i2c_addr = 0x40,
	.sensor_output_reg_addr = &hi256_reg_addr,
	.sensor_id_info = &hi256_id_info,
	.cam_mode = MSM_SENSOR_MODE_INVALID,
	.csic_params = &hi256_csi_params_array[0],
	.msm_sensor_mutex = &hi256_mut,
	.sensor_i2c_driver = &hi256_i2c_driver,
	.sensor_v4l2_subdev_info = hi256_subdev_info,
	.sensor_v4l2_subdev_info_size = ARRAY_SIZE(hi256_subdev_info),
	.sensor_v4l2_subdev_ops = &hi256_subdev_ops,
	.func_tbl = &hi256_func_tbl,
	.clk_rate = MSM_SENSOR_MCLK_24HZ,
};
#else
static struct msm_sensor_ctrl_t hi256_s_ctrl = {
	.msm_sensor_reg = &hi256_regs,
	.sensor_i2c_client = &hi256_sensor_i2c_client,
	.sensor_i2c_addr =  0x40,
	.sensor_output_reg_addr = &hi256_reg_addr,
	.sensor_id_info = &hi256_id_info,
	.cam_mode = MSM_SENSOR_MODE_INVALID,
	.csic_params = &hi256_csi_params_array[0],
	.msm_sensor_mutex = &hi256_mut,
	.sensor_i2c_driver = &hi256_i2c_driver,
	.sensor_v4l2_subdev_info = hi256_subdev_info,
	.sensor_v4l2_subdev_info_size = ARRAY_SIZE(hi256_subdev_info),
	.sensor_v4l2_subdev_ops = &hi256_subdev_ops,
	.func_tbl = &hi256_func_tbl,
	.clk_rate = MSM_SENSOR_MCLK_24HZ,
};
#endif
module_init(msm_sensor_init_module);
MODULE_DESCRIPTION("Omnivision WXGA YUV sensor driver");
MODULE_LICENSE("GPL v2");
